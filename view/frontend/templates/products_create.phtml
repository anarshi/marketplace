<?php
$helper = $this->helper('Magento\Search\Helper\Data');
?>
<div class="ks-page-content-body ks-form-steps-progress-page">
    <div class="ks-form-steps-progress">
        <div class="ks-form-steps-progress-header">
            <h3>Create new product</h3>
            <div class="ks-description">Add new product to your store</div>
        </div>
        <div class="ks-form-steps-progress-body">
            <div class="progress">
                <div class="progress-bar progress-bar" role="progressbar" style="width: 25%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"></div>
            </div>

            <div class="ks-step-items">
                <a id="first-item" href="#" class="ks-step-item ks-completed">Product Name</a>
                <a id="second-item" href="#" class="ks-step-item">Description</a>
                <a id="third-item" href="#" class="ks-step-item">Upload Media</a>
                <a id="last-item" href="#" class="ks-step-item">Finished</a>
            </div>
        </div>
    </div>
    <div class="ks-form-steps-progress-wrapper">
        <div class="ks-form-steps-progress-content">
            <div class="ks-form-steps-progress-content-wrapper ks-scrollable">
                <div class="ks-scroll-wrapper">
                    <form id="form" class="ks-step">
                        <div class="form-group">
                            <label for="productname">Product Name</label>
                            <input type="text" data-mage-init='{"quickSearch":{
                                    "formSelector":"#search_mini_form",
                                    "url":"<?php echo $this->getUrl('search/ajax/suggest'); ?>",
                                    "destinationSelector":"#search_autocomplete"}
                               }'
                                   name="<?php echo $helper->getQueryParamName() ?>"
                                   value="<?php echo $helper->getEscapedQueryText() ?>"
                                   class="form-control" id="productname" aria-describedby="productnameHelp" placeholder="Enter Product Name">
                            <small id="productnameHelp" class="form-text text-muted">Type your product name, Or select from Autocomplete list</small>
                            <div id="search_autocomplete" class="search-autocomplete"></div>
                        </div>
                        <input type="text" name="category_id" hidden="hidden" value="0">
                    </form>
                </div>
            </div>
            <div class="ks-controls ks-flex-end">
                <button class="btn btn-primary-outline ks-light ks-previous">Back</button>
                <button class="btn btn-primary ks-next">Next Step</button>
            </div>
        </div>
    </div>
</div>
<script type="text/x-magento-init">
{
    "*": {
        "Magento_Ui/js/core/app": {
            "components": {
                "searchsuiteautocomplete_form": {
                    "component": "AWstreams_Marketplace/js/autocomplete"
                },
                "searchsuiteautocompleteBindEvents": {
                    "component": "AWstreams_Marketplace/js/bindEvents",
                    "config": {
                        "searchFormSelector": "#search_mini_form",
                        "searchButtonSelector": "button.search",
                        "inputSelector": "#search, #mobile_search, .minisearch input[type=\"text\"]",
                        "searchDelay": "<?php echo $block->getSearchDelay() ?>"
                    }
                },
                "searchsuiteautocompleteDataProvider": {
                    "component": "AWstreams_Marketplace/js/dataProvider",
                    "config": {
                        "url": "<?php echo $block->getSearchUrl() ?>"
                    }
                }
            }
        }
    }
}
</script>
<script type="text/javascript">
    require(["jquery"],function($) {
        $(document).ready(function() {
            var ajaxUrl = "<?php echo $block->getAjaxUrl();?>";
            $('.ks-next').on('click', function (e) {
                $.ajax({
                    url: ajaxUrl,
                    type: 'POST',
                    dataType: 'json',
                    complete: function(response) {
                        country = response.responseJSON.default_country;
                        state = response.responseJSON.state;
                        console.log('##### Step ' + parseInt(response.respnseJSON.step) - 1 + ' Finished' );
                        console.log('##### Step ' + parseInt(response.respnseJSON.step)  + ' Started' );
                    },
                    error: function (xhr, status, errorThrown) {
                        console.log('Error happens. Try again.');
                    }
                });

            })
            });
    });
</script>